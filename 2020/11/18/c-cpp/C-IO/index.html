<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>C-IO · 风兮木落</title><meta name="description" content="方法一123456789101112131415161718192021222324252627282930313233343536void readFile(char *filename)&amp;#123;    FILE *fp;    fp = fopen(filename,&amp;quot;r&amp;quot"><meta name="og:description" content="方法一123456789101112131415161718192021222324252627282930313233343536void readFile(char *filename)&amp;#123;    FILE *fp;    fp = fopen(filename,&amp;quot;r&amp;quot"><meta name="twitter:site" content="风兮木落"><meta name="twitter:title" content="C-IO"><meta name="twitter:card" content="summary"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="container" id="stage"><div class="row"><div class="col-sm-3 col-xs-12 side-container invisible" id="side-bar"><div class="vertical-text site-title"><h3 class="site-title-small" tabindex="-1"><a class="a-title" href="/">long blogs</a></h3><h1 class="site-title-large" tabindex="-1"><a class="a-title" href="/">进一步有进一步惊喜</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div class="site-title-links" id="site-nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archive</a></li><li><a href="/tags">Tags</a></li><li class="soc"><a href="https://long95288.github.io/atom.xml" target="_blank" rel="noopener noreferrer" aria-label="RSS"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2025&nbsp;<a target="_blank" href="https://long95288.github.io" rel="noopener noreferrer">long</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div class="col-sm-9 col-xs-12 main-container invisible" id="main-container"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>C-IO</a></p><p class="post-meta"><span class="date meta-item">Posted at&nbsp;2020-11-18</span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a class="a-tag" href="/tags/linux/" title="linux">linux</a><span>&nbsp;</span><a class="a-tag" href="/tags/C/" title="C">C</a><span>&nbsp;</span></span></p><p class="post-abstract"><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">readFile</span><span class="params">(<span class="type">char</span> *filename)</span>&#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filename,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == fp)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open %s error\n&quot;</span>,filename);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">uint8_t</span> *str = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">size_t</span> calloc_size = <span class="number">1024</span>;</span><br><span class="line">    str = (<span class="type">uint8_t</span> *)<span class="built_in">calloc</span>(<span class="number">1</span>,<span class="number">1024</span>);</span><br><span class="line">    <span class="type">int</span> c = getc(fp);</span><br><span class="line">    <span class="type">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (c != EOF)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\t&quot;</span>,c);</span><br><span class="line">        <span class="keyword">if</span> (index != <span class="number">0</span> &amp;&amp; index % <span class="number">16</span> == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index &gt; calloc_size)&#123;</span><br><span class="line">            <span class="type">uint8_t</span>  *tmp = <span class="built_in">calloc</span>(<span class="number">1</span>, calloc_size * <span class="number">2</span>);</span><br><span class="line">            <span class="built_in">memcpy</span>(tmp, str, calloc_size);</span><br><span class="line">            calloc_size *= <span class="number">2</span>;</span><br><span class="line">            <span class="built_in">free</span>(str);</span><br><span class="line">            str = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        *(str + index) = c;</span><br><span class="line">        index ++;</span><br><span class="line">        c = getc(fp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;readsize: %d bytes\n&quot;</span>, index);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;callocsize: %ld bytes\n&quot;</span>, calloc_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, str);</span><br><span class="line">    <span class="built_in">free</span>(str);</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">readFile2</span><span class="params">(<span class="type">char</span> *filepath)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">statbuf</span>;</span></span><br><span class="line">    stat(filepath, &amp;statbuf);</span><br><span class="line">    <span class="type">long</span> size = statbuf.st_size;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filepath, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == fp) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open %s error\n&quot;</span>, filepath);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">uint8_t</span> *str = <span class="literal">NULL</span>;</span><br><span class="line">    str = (<span class="type">uint8_t</span> *)<span class="built_in">calloc</span>(<span class="number">1</span>, size);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == str)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;calloc failed.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> c = getc(fp);</span><br><span class="line">    <span class="type">size_t</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (c != EOF)&#123;</span><br><span class="line">        *(str + index) = c;</span><br><span class="line">        index ++;</span><br><span class="line">        c = getc(fp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,str);</span><br><span class="line">    <span class="built_in">free</span>(str);</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方法3"><a href="#方法3" class="headerlink" title="方法3"></a>方法3</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">readFile3</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filepath)</span> &#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filepath, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == fp) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open %s failed.\n&quot;</span>, filepath);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">statbuf</span>;</span></span><br><span class="line">    stat(filepath, &amp;statbuf);</span><br><span class="line">    <span class="type">long</span> size = statbuf.st_size;</span><br><span class="line">    <span class="type">char</span> *buf = <span class="built_in">calloc</span>(<span class="number">1</span>, size + <span class="number">1</span>);</span><br><span class="line">    <span class="type">size_t</span> read_size = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> *res = fgets(buf, size + <span class="number">1</span>,fp);</span><br><span class="line">    <span class="keyword">while</span> (res != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        read_size += <span class="built_in">strlen</span>(res);</span><br><span class="line">        res = fgets(buf + read_size, (size + <span class="number">1</span> - <span class="built_in">strlen</span>(res)), fp );</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, buf);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;filesize: %ld\n&quot;</span>, size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;readsize: %ld\n&quot;</span>, read_size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">writeFile</span><span class="params">(<span class="type">char</span> *filepath, <span class="type">const</span> <span class="type">uint8_t</span> *data, <span class="type">size_t</span> data_len)</span> &#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filepath, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == fp)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open %s failed.\n&quot;</span>, filepath);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">size_t</span> input_size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (input_size &lt; data_len) &#123;</span><br><span class="line">        <span class="type">int</span> c = putc(*(data + input_size), fp);</span><br><span class="line">        <span class="keyword">if</span> (c == EOF) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;write finish...\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        input_size++;</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStringToFile</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filepath, <span class="type">const</span> <span class="type">char</span> *data)</span> &#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filepath, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == fp) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open %s failed.\n&quot;</span>, filepath);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">fputs</span>(data, fp);</span><br><span class="line">    <span class="keyword">if</span>(EOF == ret) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;write string %s failed.\n&quot;</span>, data);</span><br><span class="line">        fclose(fp);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStringToFile2</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filepath, <span class="type">const</span> <span class="type">char</span> *data)</span> &#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filepath, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == fp) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open %s failed.\n&quot;</span>, filepath);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">fprintf</span>(fp, <span class="string">&quot;%s&quot;</span>, data);</span><br><span class="line">    <span class="keyword">if</span> (EOF == ret) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;write %s failed.\n&quot;</span>, data);</span><br><span class="line">        fclose(fp);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="结构体-数组读写"><a href="#结构体-数组读写" class="headerlink" title="结构体,数组读写"></a>结构体,数组读写</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">data_s</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> type;</span><br><span class="line">    <span class="type">char</span> *description;</span><br><span class="line">    <span class="type">int</span> num[<span class="number">10</span>];</span><br><span class="line">    <span class="type">char</span> str[<span class="number">1000</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">data_s</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; <span class="type">data_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">writeStruct2File</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, <span class="type">const</span> <span class="type">data_t</span> *data, <span class="type">const</span> <span class="type">size_t</span> data_size)</span>&#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filename, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == fp) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open %s failed.\n&quot;</span>, filename);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">size_t</span> write_size = fwrite(data, data_size, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;write_size: %ld\n&quot;</span>, write_size);</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">readStructfromFile</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, <span class="type">data_t</span> *data, <span class="type">size_t</span> data_size)</span> &#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    fp = fopen(filename, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    <span class="type">size_t</span> read_size = fread(data, data_size, <span class="number">1</span>, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;read_size: %ld\n&quot;</span>,read_size);</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="type">data_t</span> data;</span><br><span class="line">    </span><br><span class="line">    <span class="type">data_t</span> *data2;</span><br><span class="line">    data2 = <span class="built_in">calloc</span>(<span class="number">1</span>, <span class="keyword">sizeof</span>(<span class="type">data_t</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">memset</span>(&amp;data, <span class="number">0</span>, <span class="keyword">sizeof</span>(data));</span><br><span class="line">    <span class="built_in">strcpy</span>(data2-&gt;str, <span class="string">&quot;NEW DATA STRUCT&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    data.type = <span class="number">1000</span>;</span><br><span class="line">    data.description = <span class="built_in">calloc</span>(<span class="number">1</span>, <span class="number">30</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(data.description, <span class="string">&quot;Hello World...&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(data.str,<span class="string">&quot;this is data.str&quot;</span>);</span><br><span class="line">    <span class="type">int</span> num[<span class="number">10</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line">    <span class="built_in">memcpy</span>(data.num, num, <span class="keyword">sizeof</span>(num));</span><br><span class="line">    data.next = data2;</span><br><span class="line">    </span><br><span class="line">    writeStruct2File(<span class="string">&quot;Hello.bin&quot;</span>,&amp;data, <span class="keyword">sizeof</span>(data) + <span class="number">30</span>);</span><br><span class="line">    <span class="built_in">free</span>(data.description);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">memset</span>(&amp;data, <span class="number">0</span>, <span class="keyword">sizeof</span>(data));</span><br><span class="line">    readStructfromFile(<span class="string">&quot;Hello.bin&quot;</span>, &amp;data, <span class="keyword">sizeof</span>(data) + <span class="number">30</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;read data:::\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data-&gt;type:%d\n&quot;</span>, data.type);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data-&gt;description:%s\n&quot;</span>, data.description);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data-&gt;num::\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">10</span>;i ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;data-&gt;num[%d]:%d\n&quot;</span>, i, data.num[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data-&gt;str:%s\n&quot;</span>,data.str);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data-&gt;next: %p\n&quot;</span>,data.next);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != data.next)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;data-&gt;next-&gt;str:%s\n&quot;</span>, data.next-&gt;str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;finish!!!!&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;data struct size:%ld&quot;</span>, <span class="keyword">sizeof</span>(<span class="type">data_t</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">write_size: 1</span><br><span class="line">read_size: 1</span><br><span class="line">read data:::</span><br><span class="line">data-&gt;type:1000</span><br><span class="line">data-&gt;description:</span><br><span class="line">data-&gt;num::</span><br><span class="line">data-&gt;num[0]:1</span><br><span class="line">data-&gt;num[1]:2</span><br><span class="line">data-&gt;num[2]:3</span><br><span class="line">data-&gt;num[3]:4</span><br><span class="line">data-&gt;num[4]:5</span><br><span class="line">data-&gt;num[5]:6</span><br><span class="line">data-&gt;num[6]:7</span><br><span class="line">data-&gt;num[7]:8</span><br><span class="line">data-&gt;num[8]:8</span><br><span class="line">data-&gt;num[9]:9</span><br><span class="line">data-&gt;str:this is data.str</span><br><span class="line">data-&gt;next: 0x55fea235c260</span><br><span class="line">data-&gt;next-&gt;str:NEW DATA STRUCT</span><br><span class="line">finish!!!!data struct size:1064</span><br></pre></td></tr></table></figure>

<p>生成的文件大小为:1094字节, 为sizeof(data_t)+ 30;使用calloc的申请的内存块不会被存储.</p>
</p></div><div class="share"><span>Share</span>&nbsp;<span class="soc"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></span><span class="soc"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></span><span class="soc"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=https://long95288.github.io/2020/11/18/c-cpp/C-IO/%20风兮木落%20C-IO"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2020/11/18/c-cpp/C-printf%E6%98%BE%E7%A4%BA%E5%AD%97%E7%AC%A6%E9%A2%9C%E8%89%B2/" title="C-printf显示字符颜色"><i class="fa fa-angle-double-left"></i>&nbsp;Previous post: C-printf显示字符颜色</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2020/10/25/linux%E5%AE%89%E8%A3%85%E5%BE%AE%E4%BF%A1/" title="linux安装微信">Next post: linux安装微信&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2025&nbsp;<a target="_blank" href="https://long95288.github.io" rel="noopener noreferrer">long</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>